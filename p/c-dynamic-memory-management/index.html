<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="深入理解malloc、free与柔性数组的底层机制">
<title>【C语言基础】动态内存管理</title>

<link rel='canonical' href='https://Amarantos-Arrebol.github.io/p/c-dynamic-memory-management/'>

<link rel="stylesheet" href="/scss/style.min.f62fad6b64852a4093ae5ceb06b3f1a3f8409c5b5dd5c91806fbb732800ca9f9.css"><meta property='og:title' content="【C语言基础】动态内存管理">
<meta property='og:description' content="深入理解malloc、free与柔性数组的底层机制">
<meta property='og:url' content='https://Amarantos-Arrebol.github.io/p/c-dynamic-memory-management/'>
<meta property='og:site_name' content='PursUnre的博客'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='C语言基础' /><meta property='article:tag' content='内存管理' /><meta property='article:tag' content='malloc' /><meta property='article:tag' content='free' /><meta property='article:published_time' content='2025-11-02T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-12-10T09:21:36&#43;00:00'/><meta property='og:image' content='https://Amarantos-Arrebol.github.io/p/c-dynamic-memory-management/04.png' />
<meta name="twitter:title" content="【C语言基础】动态内存管理">
<meta name="twitter:description" content="深入理解malloc、free与柔性数组的底层机制"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://Amarantos-Arrebol.github.io/p/c-dynamic-memory-management/04.png' /><link rel="stylesheet" href="/css/custom.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>


<script>
$(document).ready(function() {
    
    $.getScript("https://cdn.jsdelivr.net/gh/huangwb8/bloghelper@latest/mouse/halo-dream/fairyDustCursor.min.js");
});
</script>


<style type="text/css">
.main-content img, body {
    cursor: url(https://cdn.jsdelivr.net/gh/huangwb8/bloghelper@latest/mouse/halo-dream/cursor/breeze/Arrow.cur), auto;
}

.actions > div,
.expand-done,
.main-content figure > figcaption div,
.navbar-above .navbar-nav .item,
.navbar-searchicon,
.navbar-slideicon,
.photos .picture-details,
.widget .ad-tag .click-close,
a,
button {
    cursor: url(https://cdn.jsdelivr.net/gh/huangwb8/bloghelper@latest/mouse/halo-dream/cursor/breeze/Hand.cur), auto;
}

blockquote,
code,
h1, h2, h3, h4, h5, h6,
hr,
input[type=text],
li,
p,
td,
textarea,
th {
    cursor: url(https://cdn.jsdelivr.net/gh/huangwb8/bloghelper@latest/mouse/halo-dream/cursor/breeze/IBeam.cur), auto;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    
    const articleContent = document.querySelector('.article-content');
    if (!articleContent) return;
    
    
    function processTextNode(node) {
        if (node.nodeType === Node.TEXT_NODE) {
            const text = node.textContent;
            
            const regex = /==([^=\n`]+?)==/g;
            
            if (regex.test(text)) {
                const parent = node.parentNode;
                
                if (parent && !['CODE', 'PRE', 'KBD', 'SAMP'].includes(parent.tagName)) {
                    const fragment = document.createDocumentFragment();
                    let lastIndex = 0;
                    
                    text.replace(/==([^=\n`]+?)==/g, function(match, content, offset) {
                        
                        if (offset > lastIndex) {
                            fragment.appendChild(document.createTextNode(text.slice(lastIndex, offset)));
                        }
                        
                        
                        const mark = document.createElement('mark');
                        mark.textContent = content;
                        fragment.appendChild(mark);
                        
                        lastIndex = offset + match.length;
                        return match;
                    });
                    
                    
                    if (lastIndex < text.length) {
                        fragment.appendChild(document.createTextNode(text.slice(lastIndex)));
                    }
                    
                    parent.replaceChild(fragment, node);
                }
            }
        } else if (node.nodeType === Node.ELEMENT_NODE && 
                   !['CODE', 'PRE', 'SCRIPT', 'STYLE', 'KBD', 'SAMP'].includes(node.tagName)) {
            
            Array.from(node.childNodes).forEach(processTextNode);
        }
    }
    
    processTextNode(articleContent);
});
</script>

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside
  class="sidebar left-sidebar sticky "
>
  <button
    class="hamburger hamburger--spin"
    type="button"
    id="toggle-menu"
    aria-label="切换菜单"
  >
    <span class="hamburger-box">
      <span class="hamburger-inner"></span>
    </span>
  </button>

  <header>
     
    <figure class="site-avatar">
      <a href="/">
           
        <img
          src="/img/avatar_hu_c3bef4dff24cf0d9.png"
          width="300"
          height="300"
          class="site-logo"
          loading="lazy"
          alt="Avatar"
        />
         
      </a>
      
      <span class="emoji">🌿</span>
      
    </figure>
     

    <div class="site-meta">
      <h1 class="site-name">
        <a href="/">PursUnre的博客</a>
      </h1>
      <h2 class="site-description">欢迎来到我的网站，此博客由【Hugo&#43;Stack】来进行搭建，主要分享个人学习笔记</h2>
    </div>
  </header><ol class="menu-social">
    
    <li>
      <a
        href="https://blog.csdn.net/green_tangerine?spm=1000.2115.3001.5343"
        target="_blank"
        
        title="CSDN"
        
        rel="me"
      >
          <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1762020245107" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4643" width="32" height="32" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M568.917333 626.005333l16.213334 2.474667c5.674667-0.64 10.965333-1.109333 15.914666-1.578667 9.941333-0.938667 18.688-1.792 27.221334-3.498666 38.4-7.68 67.968-27.434667 83.2-64.768 10.325333-25.002667 11.690667-51.242667 8.533333-77.653334-4.864-41.088-23.68-72.96-64.085333-88.106666-39.125333-14.634667-78.336-9.301333-117.077334 2.56-6.186667 1.92-9.685333 6.954667-10.24 13.653333-1.152 13.141333-2.304 26.24-3.541333 39.338667-4.821333 51.328-9.557333 102.656-14.208 153.984-0.896 9.642667 2.304 14.506667 12.202667 16.213333 15.744 2.816 31.445333 5.205333 45.866666 7.381333z m21.589334-33.450666c-2.602667 0.170667-5.12 0.341333-7.381334 0.554666l-10.624-0.725333a2204.416 2204.416 0 0 0-15.36-0.981333c-5.76-0.256-8.149333-2.816-7.509333-8.96 1.536-15.36 2.901333-30.634667 4.266667-45.994667l2.048-22.912 2.858666-30.848 4.693334-51.114667v-0.170666c0.426667-4.565333 0.768-8.533333 6.4-9.770667 20.053333-4.352 40.234667-6.698667 60.458666-1.962667 28.032 6.570667 43.093333 25.813333 49.194667 52.906667 5.546667 24.618667 5.205333 49.152-4.565333 72.746667-11.776 28.416-36.096 40.021333-64.426667 45.141333-6.826667 1.28-13.781333 1.706667-20.053333 2.133333zM308.437333 606.208c23.765333 16.341333 50.986667 20.778667 79.189334 20.992 17.152 0.170667 34.005333-1.706667 49.92-8.448 25.216-10.666667 38.101333-30.421333 41.429333-56.917333 3.328-26.496-6.144-47.744-29.098667-61.568a242.346667 242.346667 0 0 0-38.4-18.218667c-8.405333-3.242667-16.981333-5.930667-25.514666-8.618667a367.957333 367.957333 0 0 1-29.781334-10.325333c-17.28-7.253333-18.517333-19.498667-5.034666-32.725333 17.237333-16.896 49.621333-18.176 69.888-2.133334 5.845333 4.608 10.837333 10.368 15.744 16.085334l1.365333 1.578666c6.144 7.125333 12.757333 8.021333 19.925333 1.962667 11.776-9.813333 11.690667-25.6-0.426666-36.693333-22.570667-20.650667-49.408-29.696-79.573334-26.197334-27.904 3.242667-51.626667 15.189333-66.986666 39.936-13.994667 22.613333-9.088 48.554667 13.397333 62.634667 10.24 6.442667 21.973333 10.666667 33.536 14.933333 2.133333 0.725333 4.181333 1.493333 6.229333 2.261334 8.234667 3.029333 16.512 5.802667 24.874667 8.533333 10.368 3.413333 20.736 6.869333 30.890667 10.837333 12.458667 4.906667 19.498667 14.677333 19.029333 28.885334-0.597333 16.512-7.637333 28.586667-23.808 33.792-27.946667 9.130667-83.2 6.4-102.058667-30.421334-3.84-7.296-10.368-8.021333-17.792-3.925333-13.44 7.466667-17.28 23.04-7.466666 34.986667 5.930667 7.168 12.8 13.482667 20.48 18.773333zM805.674667 410.538667c3.882667-1.962667 7.850667-4.181333 11.861333-6.485334 9.130667-5.12 18.730667-10.581333 29.013333-13.653333 30.592-9.130667 61.269333-7.509333 88.490667 11.136 21.162667 14.506667 30.293333 36.096 28.458667 61.354667-2.346667 32.085333-5.205333 64.170667-8.021334 96.256-1.408 15.786667-2.816 31.530667-4.138666 47.274666-1.408 16.725333-18.56 26.453333-33.066667 18.090667-2.688-1.536-4.778667-6.826667-4.565333-10.24 1.365333-21.12 3.157333-42.197333 4.992-63.232l0.768-9.002667 2.261333-25.216c1.749333-19.2 3.498667-38.4 4.693333-57.6 0.896-13.141333-4.693333-23.893333-16.298666-31.232-30.848-19.498667-71.68-9.728-94.208 22.485334-15.616 22.442667-21.205333 47.616-23.04 74.410666-1.365333 20.352-3.328 40.661333-5.333334 60.928l-2.944 30.890667c-0.512 5.973333-3.669333 9.002667-9.386666 9.386667a89.386667 89.386667 0 0 1-12.373334 0c-10.496-0.810667-14.890667-6.656-13.994666-17.066667 2.304-26.197333 4.48-52.48 6.656-78.677333l2.773333-32.853334 2.005333-24.234666c1.493333-18.474667 2.986667-36.906667 4.693334-55.338667 1.365333-15.018667 19.328-25.856 32.64-19.072 2.986667 1.536 4.778667 5.248 6.314666 8.362667 0.597333 1.28 1.152 2.432 1.749334 3.328zM95.445333 603.008c22.698667 18.346667 49.493333 23.893333 77.952 24.064 27.946667-0.128 54.570667-5.12 78.549334-20.650667a22.357333 22.357333 0 0 0 10.965333-23.893333 22.186667 22.186667 0 0 0-13.184-17.706667c-6.698667-2.901333-11.434667 1.194667-16.341333 5.546667l-0.298667 0.213333a72.149333 72.149333 0 0 1-17.706667 11.776c-22.613333 10.112-46.336 11.008-70.186666 5.504-23.466667-5.461333-38.954667-20.138667-44.032-43.904-7.893333-36.949333-0.981333-71.253333 23.168-100.565333 17.834667-21.76 41.813333-31.018667 69.205333-21.76 9.173333 3.072 17.322667 9.386667 25.344 15.616 2.261333 1.749333 4.522667 3.498667 6.741333 5.12 7.210667 5.376 13.525333 5.546667 19.2-1.450667a23.338667 23.338667 0 0 0-1.962666-32.682666 87.381333 87.381333 0 0 0-58.410667-23.552c-48.128-1.194667-82.901333 21.888-106.24 62.677333-16.341333 28.458667-21.376 59.477333-16.938667 92.032 3.456 25.472 13.909333 47.232 34.133334 63.573333z" fill="#707070" p-id="4644"></path></svg> 
      </a>
    </li>
    
    <li>
      <a
        href="https://gitee.com/green-citrus"
        target="_blank"
        
        title="Gitee"
        
        rel="me"
      >
          <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1762076613092" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2602" width="32" height="32" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M690.194 479.706H496.998v0.004c-9.275 0-16.798 7.518-16.8 16.795l-0.016 42h-0.004c-0.002 9.277 7.518 16.799 16.796 16.803h0.004l117.618-0.004c9.277 0 16.8 7.522 16.8 16.8v8.4c0 27.832-22.564 50.398-50.399 50.398h-159.61c-9.277 0-16.797-7.522-16.797-16.8l-0.004-159.597h-0.002c0-27.834 22.562-50.398 50.397-50.4h0.002l235.164 0.002v-0.011c9.275 0 16.794-7.516 16.8-16.789l0.037-41.999h0.011c0.006-9.277-7.512-16.804-16.79-16.81h-0.01l-235.195 0.01c-69.586 0-125.998 56.412-125.998 125.997L329 689.701c0 9.277 7.522 16.8 16.8 16.8h247.796c62.628 0 113.398-50.768 113.398-113.397v-96.599c0-9.277-7.522-16.799-16.8-16.799z" p-id="2603" fill="#515151"></path></svg> 
      </a>
    </li>
    
    <li>
      <a
        href="https://github.com/Amarantos-Arrebol"
        target="_blank"
        
        title="GitHub"
        
        rel="me"
      >
          <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>


 
      </a>
    </li>
    
  </ol><ol class="menu" id="main-menu">
      
    <li >
      <a
        href="/"
        
      >
           <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>


 
        <span>主页</span>
      </a>
    </li>
     
    <li >
      <a
        href="/archives/"
        
      >
           <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>


 
        <span>归档</span>
      </a>
    </li>
     
    <li >
      <a
        href="/search/"
        
      >
           <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>


 
        <span>搜索</span>
      </a>
    </li>
     
    <li >
      <a
        href="/%E6%8A%80%E6%9C%AF%E9%93%BE%E6%8E%A5/"
        
      >
           <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>


 
        <span>技术链接</span>
      </a>
    </li>
    
    <li class="menu-bottom-section">
      <ol class="menu"> 
        <li id="dark-mode-toggle">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>


 <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



          <span>暗色模式</span>
        </li>
        
      </ol>
    </li>
  </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#1为什么要有动态内存管理">1、为什么要有动态内存管理</a></li>
    <li><a href="#2malloc和free">2、malloc和free</a>
      <ul>
        <li><a href="#21-基本介绍">2.1 基本介绍</a></li>
        <li><a href="#23-malloc申请空间和数组的空间有什么区别呢">2.3 malloc申请空间和数组的空间有什么区别呢？</a></li>
        <li><a href="#24-内存中数据的存储划分">2.4 内存中数据的存储划分</a></li>
        <li><a href="#25-free">2.5 free</a></li>
      </ul>
    </li>
    <li><a href="#3calloc和realloc">3、calloc和realloc</a>
      <ul>
        <li><a href="#31calloc">3.1calloc</a></li>
        <li><a href="#32-realloc">3.2 realloc</a></li>
        <li><a href="#33-realloc是如何扩容空间的">3.3 realloc是如何扩容空间的</a></li>
      </ul>
    </li>
    <li><a href="#4常见的动态内存的错误">4、常见的动态内存的错误</a></li>
    <li><a href="#5经典笔试题分析">5、经典笔试题分析</a></li>
    <li><a href="#6柔性数组">6、柔性数组</a>
      <ul>
        <li><a href="#61-基本介绍">6.1 基本介绍</a></li>
        <li><a href="#62-柔性数组的特点">6.2 柔性数组的特点</a></li>
        <li><a href="#63与变长数组的区别">6.3与变长数组的区别</a></li>
        <li><a href="#64-使用柔性数组的优势">6.4 使用柔性数组的优势</a></li>
        <li><a href="#7总结cc中程序内存区域划分">7、总结C/C++中程序内存区域划分</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </div>
    </section>

            
        
        
        
        <div id="back-to-top">
            <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
                <path d="M512 298.666667l-298.666667 310.912L283.52 682.666667 512 445.312 740.48 682.666667 810.666667 609.578667z"></path>
            </svg>
        </div>
    </aside>



<script>
(function() {
    const backToTopButton = document.getElementById('back-to-top');
    if (!backToTopButton) return;
    
    
    window.addEventListener('scroll', function() {
        if (window.pageYOffset > 300) {
            backToTopButton.classList.add('show');
        } else {
            backToTopButton.classList.remove('show');
        }
    });
    
    
    backToTopButton.addEventListener('click', function() {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    });
})();
</script>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/c-dynamic-memory-management/">
                <img src="/p/c-dynamic-memory-management/04_hu_373845668b196388.png"
                        srcset="/p/c-dynamic-memory-management/04_hu_373845668b196388.png 800w, /p/c-dynamic-memory-management/04_hu_576771f7eb678e5.png 1600w"
                        width="800" 
                        height="450" 
                        loading="lazy"
                        alt="Featured image of post 【C语言基础】动态内存管理" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/c/" style="background-color: #93BFC7; color: #fff;">
                C
            </a>
        
            <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="background-color: #B7A3E3; color: #fff;">
                学习笔记
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/c-dynamic-memory-management/">【C语言基础】动态内存管理</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            深入理解malloc、free与柔性数组的底层机制
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div class="article-time-item">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2025-11-02</time>
            </div><span class="article-time-divider">|</span>
            <div class="article-time-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-file-pencil"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M10 18l5 -5a1.414 1.414 0 0 0 -2 -2l-5 5v2h2z" /></svg>
                <time class="article-time--updated">2025-12-10</time>
            </div><span class="article-time-divider">|</span>
            <div class="article-time-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-file-word"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2" /><path d="M9 12l1.333 5l1.667 -4l1.667 4l1.333 -5" /></svg>
                <span class="article-time--wordcount">2390 字
                </span>
            </div>
        

        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="1为什么要有动态内存管理">1、为什么要有动态内存管理
</h1><p>向内存申请一块空间存放数据的方法</p>
<p>1）创建一个变量</p>
<p>2）创建一个数组，数组编译时开辟空间</p>
<p>**缺陷：**1.空间开辟的大小是固定的</p>
<p>​           2.数组在声明的时候，必须指定数组的长度，数组空间一旦确定了大小不能调整</p>
<p>但对于空间的需求，有时候我们需要的空间大小在<mark>程序运行</mark>的时候才能知道</p>
<p>所以我们引入动态内存开辟，让程序员自己可以申请和释放空间</p>
<p>动态内存管理的头文件stdlib.h</p>
<h1 id="2malloc和free">2、malloc和free
</h1><h2 id="21-基本介绍">2.1 基本介绍
</h2><p>memory:内存</p>
<p>alloc:空间开辟</p>
<p>向内存申请一块连续可用的空间（大小是字节），并返回指向这块空间的指针</p>
<p>返回值void*：将这块空间起始地址返回，malloc函数并不知道开辟空间的类型</p>
<p>​                     具体使用的时候，应该将其强转为我们期望的类型的指针</p>
<p><strong>注意：</strong></p>
<p>1、参数的单位是字节</p>
<p>2、对malloc返回的指针做判断</p>
<p>​     申请空间成功的话，返回起始地址；申请失败，返回NULL</p>
<p>3、如果参数size为0，malloc的行为是标准是未定义的，取决于编译器</p>
<h2 id="23-malloc申请空间和数组的空间有什么区别呢">2.3 malloc申请空间和数组的空间有什么区别呢？
</h2><p>1、动态内存的大小是可以调整的</p>
<p>2、开辟空间的位置不一样</p>
<h2 id="24-内存中数据的存储划分">2.4 内存中数据的存储划分
</h2><p>1）栈区：局部变量，局部的数组，函数的形式参数</p>
<p>2）堆区：动态内存malloc，free，calloc，realloc</p>
<p>3）静态区：全局变量，static修饰的静态变量</p>
<h2 id="25-free">2.5 free
</h2><p>malloc申请的这块空间，使用完后，不想要了，需要释放</p>
<p>free是将申请的那块空间的使用权限还给操作系统了</p>
<p>是通过代码的方式释放内存，如果不释放，程序结束的时候也会被操作系统自动回收</p>
<p>但是指向这块空间的指针p，指向的空间不属于当前程序，但还是找得到</p>
<p>这块空间（p是野指针，所以要将p置为空）</p>
<p><strong>注意</strong></p>
<p>1、如果参数ptr指向的空间不是动态开辟的，那free函数的行为是未定义的</p>
<p>2、如果参数ptr是NULL指针，则函数什么事都不做</p>
<p>3、free释放的空间一定是动态申请的</p>
<p>malloc和free最好成对使用</p>
<h1 id="3calloc和realloc">3、calloc和realloc
</h1><h2 id="31calloc">3.1calloc
</h2><p>开辟num个大小为size的空间，并用0初始化数组，返回地址</p>
<p>malloc不会把申请的空间初始化，calloc会初始化，因此calloc函数效率要低一些</p>
<h2 id="32-realloc">3.2 realloc
</h2><p><mark>realloc 不仅能调整空间，还可以申请空间</mark></p>
<p>把已经通过malloc或realloc开辟的空间进行调整，</p>
<p>ptr：要调整的内存空间的起始地址</p>
<p>size：需要调整多大的空间</p>
<p>返回值为调整后内存的起始地址</p>
<h2 id="33-realloc是如何扩容空间的">3.3 realloc是如何扩容空间的
</h2><p>realloc函数在调整空间时，有两种情况</p>
<p>可以扩容的情况</p>
<p>情况1：原有空间后，尚未分配的空间足够</p>
<p>情况2：原有空间后，尚未分配的空间不够</p>
<p>1）realloc直接在内存的堆区找到一块新的满足大小的空间</p>
<p>2）将旧的数据，拷贝到新的空间</p>
<p>3）释放旧空间</p>
<p>4）返回新的地址</p>
<p>所以realloc函数可能返回新的地址，也可能返回旧地址，还可能返回NULL指针</p>
<p>因为可能开辟失败，为了避免返回NULL指针，使原有的数据也丢失，所以</p>
<p>需要新创建一个指针变量接收，如果该指针变量不为NULL，再将它的值赋给原有的</p>
<p>指针变量</p>
<h1 id="4常见的动态内存的错误">4、常见的动态内存的错误
</h1><ul>
<li>对NULL指针的解引用操作</li>
</ul>
<p>对动态申请的空间返回的的指针先要判断是否为NULL</p>
<ul>
<li>
<p>对动态开辟空间的越界访问</p>
</li>
<li>
<p>对非动态开辟内存使用free释放</p>
</li>
<li>
<p>使用free释放一块动态开辟内存的一部分</p>
</li>
</ul>
<p>p[i] = i相当于  *（p+i），此时free(p)正确</p>
<p>*p = i; p++;  此时free(p)会报错</p>
<ul>
<li>
<p>对同一块内存空间的多次释放</p>
</li>
<li>
<p>动态内存开辟忘记释放，可能导致内存泄漏的问题</p>
<p>服务器的程序，7*24一直在运行</p>
</li>
</ul>
<p><strong>内存管理是一把双刃剑</strong></p>
<p>1、提供灵活的内存管理方式</p>
<p>2、带来风险</p>
<h1 id="5经典笔试题分析">5、经典笔试题分析
</h1><h1 id="6柔性数组">6、柔性数组
</h1><h2 id="61-基本介绍">6.1 基本介绍
</h2><p>C99中，结构中最后一个元素允许是未知大小的数组，这就叫【柔性数组】成员</p>
<p>1、结构体中</p>
<p>2、最后一个成员</p>
<p>3、未知大小的数组</p>
<p><img src="/p/c-dynamic-memory-management/%E3%80%90C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E3%80%91%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"
	width="842"
	height="372"
	
	loading="lazy"
	
		alt="72857032141"
	
	
		class="gallery-image" 
		data-flex-grow="226"
		data-flex-basis="543px"
	
></p>
<h2 id="62-柔性数组的特点">6.2 柔性数组的特点
</h2><p>1、结构中的柔性数组成员前面必须至少一个其它成员</p>
<p>2、sizeof返回的这种结构大小不包括柔性数组的内容</p>
<p>3、包含柔性数组成员的结构用malloc()函数进行内存的动态分配，并且分配的内存应该</p>
<p>​      大于结构的大小，以适应柔性数组的预期大小</p>
<p>​     内存大小=结构大小+柔性数组大小</p>
<p><img src="/p/c-dynamic-memory-management/%E3%80%90C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E3%80%91%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"
	width="873"
	height="468"
	
	loading="lazy"
	
		alt="72857034475"
	
	
		class="gallery-image" 
		data-flex-grow="186"
		data-flex-basis="447px"
	
></p>
<p><img src="/assets/1728570355498.png"
	
	
	
	loading="lazy"
	
		alt="72857035549"
	
	
></p>
<p>因为n和arr都是malloc来的，所以后面可以通过realloc来调整这块空间</p>
<p>一旦使用realloc来调整这块空间，那么后面的数组的空间大小就可以可大可小</p>
<h2 id="63与变长数组的区别">6.3与变长数组的区别
</h2><p>变长数组：指用整型变量或表达式声明或定义的数组</p>
<p>数组的大小可以由变量来进行指定，并不是数组的大小可变</p>
<p>变长数组大小一旦开辟好空间，就不能变</p>
<p><img src="/p/c-dynamic-memory-management/%E3%80%90C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E3%80%91%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"
	width="566"
	height="352"
	
	loading="lazy"
	
		alt="72857038543"
	
	
		class="gallery-image" 
		data-flex-grow="160"
		data-flex-basis="385px"
	
></p>
<h2 id="64-使用柔性数组的优势">6.4 使用柔性数组的优势
</h2><p>1）方便内存释放，一次free就搞定</p>
<p>如果我们的代码是在一个给别人的函数中，你做了二次内存分配，并返回结构体的地址给</p>
<p>用户。用户调用free可以释放结构体，但用户不知道这个结构体里的成员也需要free.</p>
<p>所以，我们尽量把结构体的内存以及成员要的内存一次性分配好</p>
<p>2）有利于访问速度（连续的内存有益于提高访问速度，也有益于减少内存碎片）</p>
<p><img src="/p/c-dynamic-memory-management/%E3%80%90C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E3%80%91%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"
	width="1600"
	height="573"
	
	loading="lazy"
	
		alt="72857042950"
	
	
		class="gallery-image" 
		data-flex-grow="279"
		data-flex-basis="670px"
	
></p>
<p>注意最后要释放动态开辟的空间</p>
<h2 id="7总结cc中程序内存区域划分">7、总结C/C++中程序内存区域划分
</h2><ul>
<li>
<p>内核空间：用户代码不能读写</p>
</li>
<li>
<p>栈（向下增长）：运行函数而分配的局部变量，函数的形式参数，返回数据，返回地址等</p>
</li>
<li>
<p>内存映射段：文件映射、动态库、匿名映射</p>
</li>
<li>
<p>堆（向上增长）：动态申请的内存，都在堆区</p>
</li>
<li>
<p>静态区（数据段）：全局数据、静态数据</p>
</li>
<li>
<p>代码段：可执行代码/只读常量，不能修改</p>
</li>
</ul>
<p><img src="/p/c-dynamic-memory-management/%E3%80%90C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E3%80%91%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"
	width="1102"
	height="760"
	
	loading="lazy"
	
		alt="72857046901"
	
	
		class="gallery-image" 
		data-flex-grow="145"
		data-flex-basis="348px"
	
></p>
<p><strong>C/C++程序内存分配的几个区域：</strong></p>
<p><strong>栈区</strong>，执行函数时，函数局部变量的存储单元都在栈上创建，函数执行结束时这些存储单元</p>
<p>自动被释放。栈内存分配运算内置于处理器的指令集中，效率很高，但分配的内存容量有限</p>
<p><strong>堆区</strong>一般由程序员分配释放，若程序员不释放，程序结束可能由OS（操作系统）回收</p>
<p>分配方式类似于链表</p>
<p><strong>数据段（静态区）</strong>：(static)存放全局变量、静态数据。程序结束后由系统释放</p>
<p><strong>代码段</strong>：存放函数体（类成员函数和全局函数）的二进制代码</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/c%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/">C语言基础</a>
        
            <a href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/">内存管理</a>
        
            <a href="/tags/malloc/">Malloc</a>
        
            <a href="/tags/free/">Free</a>
        
    </section>


    
</footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/c-memory-memory-related-functions/">
        
        
            <div class="article-image">
                <img src="/p/c-memory-memory-related-functions/04.56f238804d2899b0bbfdeb2ecda0b14a_hu_586fa9faf358957.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post 【C语言基础】内存相关的函数"
                        data-key="c-memory-memory-related-functions" 
                        data-hash="md5-VvI4gE0ombC7/esuzaCxSg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">【C语言基础】内存相关的函数</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/c-char-and-string-function/">
        
        
            <div class="article-image">
                <img src="/p/c-char-and-string-function/04.56f238804d2899b0bbfdeb2ecda0b14a_hu_586fa9faf358957.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post 【C语言基础】字符和字符串函数"
                        data-key="c-char-and-string-function" 
                        data-hash="md5-VvI4gE0ombC7/esuzaCxSg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">【C语言基础】字符和字符串函数</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/c-pointer-basic/">
        
        
            <div class="article-image">
                <img src="/p/c-pointer-basic/04.56f238804d2899b0bbfdeb2ecda0b14a_hu_586fa9faf358957.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post 【C语言基础】指针入门"
                        data-key="c-pointer-basic" 
                        data-hash="md5-VvI4gE0ombC7/esuzaCxSg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">【C语言基础】指针入门</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/c-struct/">
        
        
            <div class="article-image">
                <img src="/p/c-struct/04.56f238804d2899b0bbfdeb2ecda0b14a_hu_586fa9faf358957.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post 【C语言基础】结构体"
                        data-key="c-struct" 
                        data-hash="md5-VvI4gE0ombC7/esuzaCxSg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">【C语言基础】结构体</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/c-memory-management/">
        
        
            <div class="article-image">
                <img src="/p/c-memory-management/05.e21599781b5af128cb4088245af86b9d_hu_39c641d01d069a51.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post 【C&#43;&#43;初阶】05内存管理"
                        data-key="c&#43;&#43;-memory-management" 
                        data-hash="md5-4hWZeBta8SjLQIgkWvhrnQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">【C&#43;&#43;初阶】05内存管理</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 PursUnre
    </section>
    
    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.31.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.9c1a6570230d4822a0bae7b9729a4d803a1d6e81a2ebc4dbb042dd1c2902034a.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
